From febbe2cf6ff1cb4b86b6c8cd5a49b513001cb38a Mon Sep 17 00:00:00 2001
From: Art_Chen <Chenxy0201@qq.com>
Date: Fri, 8 Jan 2021 16:05:14 +0800
Subject: [PATCH] OP4A89: Add an extra config for customCutout Size adjust

---
 packages/SystemUI/res/values/lineage_config.xml           | 3 +++
 packages/SystemUI/res/values/lineage_dimens.xml           | 5 ++++-
 .../src/com/android/systemui/ScreenDecorations.java       | 8 +++++---
 3 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/packages/SystemUI/res/values/lineage_config.xml b/packages/SystemUI/res/values/lineage_config.xml
index d1e9ea7b792..1c5fe5b4f95 100644
--- a/packages/SystemUI/res/values/lineage_config.xml
+++ b/packages/SystemUI/res/values/lineage_config.xml
@@ -30,4 +30,7 @@
 
     <!-- If not zero, limits the internal screen recorder's framerate to the set value. -->
     <integer name="config_screenRecorderMaxFramerate">0</integer>
+
+    <!-- Allow devices to use unordinary cutout overlays -->
+    <bool name="config_customCutout">false</bool>
 </resources>
diff --git a/packages/SystemUI/res/values/lineage_dimens.xml b/packages/SystemUI/res/values/lineage_dimens.xml
index 39fa8da2423..a2599fff8c9 100644
--- a/packages/SystemUI/res/values/lineage_dimens.xml
+++ b/packages/SystemUI/res/values/lineage_dimens.xml
@@ -16,5 +16,8 @@
      limitations under the License.
 -->
 <resources>
-
+   <!-- Custom cutout overlay view radius -->
+   <dimen name="config_customCutoutRadius">0.0px</dimen>
+   <dimen name="config_customCutoutTopRadius">0.0px</dimen>
+   <dimen name="config_customCutoutBottomRadius">0.0px</dimen>
 </resources>
diff --git a/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java b/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
index dba1e4cabcb..e61a3c5393a 100644
--- a/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
+++ b/packages/SystemUI/src/com/android/systemui/ScreenDecorations.java
@@ -160,6 +160,7 @@ public class ScreenDecorations extends SystemUI implements Tunable,
     private boolean mFullscreenMode = false;
     private boolean mImmerseMode = false;
     private StatusBar mStatusBar = (StatusBar) Dependency.get(StatusBar.class);
+    private boolean mCustomCutout;
 
     private CameraAvailabilityListener.CameraTransitionCallback mCameraTransitionCallback =
             new CameraAvailabilityListener.CameraTransitionCallback() {
@@ -294,6 +295,7 @@ public class ScreenDecorations extends SystemUI implements Tunable,
 
     private void setupDecorations() {
         if (hasRoundedCorners() || shouldDrawCutout()) {
+            mCustomCutout = mContext.getResources().getBoolean(R.bool.config_customCutout);
             final DisplayCutout cutout = getCutout();
             final Rect[] bounds = cutout == null ? null : cutout.getBoundingRectsAll();
             int rotatedPos;
@@ -643,11 +645,11 @@ public class ScreenDecorations extends SystemUI implements Tunable,
         // device configured using the single integer config value is okay with drawing the corners
         // as a square
         final int newRoundedDefault = mContext.getResources().getDimensionPixelSize(
-                com.android.internal.R.dimen.rounded_corner_radius);
+                mCustomCutout ? R.dimen.config_customCutoutRadius : com.android.internal.R.dimen.rounded_corner_radius);
         final int newRoundedDefaultTop = mContext.getResources().getDimensionPixelSize(
-                com.android.internal.R.dimen.rounded_corner_radius_top);
+                mCustomCutout ? R.dimen.config_customCutoutTopRadius : com.android.internal.R.dimen.rounded_corner_radius_top);
         final int newRoundedDefaultBottom = mContext.getResources().getDimensionPixelSize(
-                com.android.internal.R.dimen.rounded_corner_radius_bottom);
+                mCustomCutout ? R.dimen.config_customCutoutBottomRadius : com.android.internal.R.dimen.rounded_corner_radius_bottom);
 
         final boolean changed = mRoundedDefault.x != newRoundedDefault
                         || mRoundedDefaultTop.x != newRoundedDefault
-- 
2.17.2 (Apple Git-113)

